<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      >

    <ui:composition template="WEB-INF/DefaultTemplate.xhtml">

        <ui:param name="active" value="User" />
        <ui:param name="title" value="User anlegen" />

        <ui:define name="titleHeader">
            <h2>#{title}</h2>
        </ui:define>

        <ui:define name="mainContent">

            <h:form id="userInput">

<!--Name -->
                <div class="form-group">
                    <label for="firstname">Vor- und Nachname:<h:message for="firstname" class="text-danger" /></label>
                    <div class="row">
                        <div class="col-6">
                            <h:inputText id="firstname" value="#{backingBeanUser.current.firstname}" class="form-control" required="false" requiredMessage="Erforderlich!"><!-- <f:validator validatorId="customValidator" />--></h:inputText>
                        </div>
                        <div class="col-6">
                            <h:inputText id="lastname" value="#{backingBeanUser.current.lastname}" class="form-control" required="false" requiredMessage="Erforderlich!"><!-- <f:validator validatorId="customValidator" />--></h:inputText>
                        </div>
                    </div>
                </div>
<!--Mail -->
                <h:inputHidden value="#{backingBeanUser.current.prim}" />

                <div class="form-group">
                    <label for="email">E-Mail:<h:message for="email" class="text-danger" /></label>
                    <h:inputText id="email" value="#{backingBeanUser.current.email}" class="form-control" required="false" requiredMessage="Erforderlich!"
                                 valueChangeListener="#{loginController.emailChanged}">
                        <!-- <f:validator validatorId="customValidator" />-->
                    </h:inputText>
                </div>
<!--Phone -->
                <div class="form-group">
                    <label for="phoneNumber">Telefon:<h:message for="phoneNumber" class="text-danger" /></label>
                    <h:inputText id="phoneNumber" value="#{backingBeanUser.current.phoneNumber}" class="form-control" required="false" requiredMessage="Erforderlich!">
                        <!-- <f:validator validatorId="customValidator" />-->
                    </h:inputText>
                </div>
<!--Adresse-->
                <div class="form-group">
                    <label for="street">Straße und Hausnummer<h:message for="street" class="text-danger" /></label>
                    <div class="row">
                        <div class="col-9">
                            <h:inputText id="street" value="#{backingBeanUser.current.addressLiving.street}" class="form-control" required="false" requiredMessage="Erforderlich!"><!-- <f:validator validatorId="customValidator" />--></h:inputText>
                        </div>
                        <div class="col-3">
                            <h:inputText id="houseNumber" value="#{backingBeanUser.current.addressLiving.houseNumber}" class="form-control" required="false" requiredMessage="Erforderlich!"><!-- <f:validator validatorId="customValidator" />--></h:inputText>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="zipCode">PLZ und Ort:<h:message for="zipCode" class="text-danger" /></label>
                    <div class="row">
                        <div class="col-3">
                            <h:inputText id="zipCode" value="#{backingBeanUser.current.addressLiving.zipCode}" class="form-control" required="false" requiredMessage="Erforderlich!"><!-- <f:validator validatorId="customValidator" />--></h:inputText>
                        </div>
                        <div class="col-9">
                            <h:inputText id="city" value="#{backingBeanUser.current.addressLiving.city}" class="form-control" required="false" requiredMessage="Erforderlich!"><!-- <f:validator validatorId="customValidator" />--></h:inputText>
                        </div>
                    </div>
                </div>

                <h:commandButton action="#{backingBeanUser.requestWgsForAddress()}" value="Hole WGS zu Adresse" class="btn btn-success" update="@form"/>

<!--Position-->
                <p:growl id="growlLocation" showDetail="true" sticky="true" />
                <p:panel>
                <div class="form-group">
                    <label for="wgs84Lat">Position auf Breiten- und Längengrad:
                        <h:commandLink id="linkGrabPos" >jetzt ermitteln!</h:commandLink></label>
                    
                    <div class="row">
                        <div class="col-6">
                            <p:inputText id="wgs84Lat" value="#{backingBeanUser.validateLat}" class="form-control" validator="#{serverValidatorWGS.validate}" >
                                <p:clientValidator/>
                                <f:validateRegex pattern="^((?!((,|\.)(.*)(,|\.))|((\+|\-)(.*)(\+|\-))|([a-z])|(([0-9,\.]\+)|([0-9,\.]\-)|((\+|\-)$)|(.\s.))).)*$"/>
                            </p:inputText>

                        </div>
                        <div class="col-6">
                            <p:inputText id="wgs84Lon" value="#{backingBeanUser.validateLon}" class="form-control" validator="#{serverValidatorWGS.validate}" >
                                <p:clientValidator/>
                                <f:validateRegex pattern="^((?!((,|\.)(.*)(,|\.))|((\+|\-)(.*)(\+|\-))|([a-z])|(([0-9,\.]\+)|([0-9,\.]\-)|((\+|\-)$)|(.\s.))).)*$"/>
                            </p:inputText>
                        </div>
                        <p:commandButton validateClient="true" ajax="false" rendered="#{false}" update="@form"/>
                    </div>
                </div>
                </p:panel>
                <br/>

<!--Culinaries            -->
                <!-- equals, hashcode und toString müssen implementiert sein-->
                <!-- https://stackoverflow.com/questions/17343032/implement-converters-for-entities-with-java-generics/17343582#17343582-->
                <div>
                    <h:selectOneMenu value="#{backingBeanUser.current.culinaryLiking}" select2="true" styleClass="form-control"  converter="omnifaces.SelectItemsConverter">
                        <f:selectItem itemLabel="Favorisierte Küche" itemValue="" />
                        <f:selectItems value="#{backingBeanUser.getAllCulinaries()}" var="culi" itemValue="#{culi}" itemLabel="#{culi.getCategory()}"/>
                    </h:selectOneMenu>
                </div>
                <br/>


<!--Password -->
                <div class="form-group">
                    <label for="password">Passwort:<h:message for="password" class="text-danger" /></label>
                    <div class="row">
                        <div class="col-12">
                        <p:password id="password" value="#{backingBeanUser.current.password}" class="form-control" required="false" requiredMessage="Erforderlich!"
                        toggleMask="true" redisplay="true" feedback="true" inline="true" maxlength="50" size="100"
                                    valueChangeListener="#{loginController.passwordChanged}">

                        </p:password>
                        </div>
                    </div>
                </div>










<!-- Buttons    -->
                <hr/>
                <h:commandButton action="#{backingBeanUser.saveUser()}" value="Speichern" class="btn btn-success" update="@form"/>
                <h:commandButton action="#{backingBeanUser.createNew()}" value="User anlegen" class="btn btn-primary" />
                <h:commandButton action="#{backingBeanUser.createNew()}" value="#Restaurantbesuch mit diesem User" class="btn btn-warning" />
            </h:form>


<!-- Skripte    -->
            <script type="text/javascript">
                document.getElementById("userInput:linkGrabPos").onclick = function()
                {
                    if (navigator.geolocation) // Abfrage ob Browser WGS liefern kann
                    {
                        navigator.geolocation.getCurrentPosition(showPosition)
                    }
                    else
                    {
                        document.getElementById("userInput:wgs84Lat").innerHTML = "Ihr Browser unterstützt keine Geo-Locations.";
                    }
                }

                function showPosition(pos)
                {
                    document.getElementById("userInput:wgs84Lat").setAttribute("value", pos.coords.latitude.toPrecision(15));
                    document.getElementById("userInput:wgs84Lon").setAttribute("value", pos.coords.longitude.toPrecision(15));
                    // console.log(pos.coords.accuracy);
                    // console.log(pos.coords.altitude);
                    // console.log(pos.coords.altitudeAccuracy);
                    // console.log(pos.coords.heading);
                    // console.log(pos.coords.speed);
                }
            </script>

        </ui:define>

        <ui:define name="subContent"></ui:define>
        <ui:define name="footer"></ui:define>
    </ui:composition>
</html>