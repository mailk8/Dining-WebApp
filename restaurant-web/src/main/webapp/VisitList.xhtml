<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="WEB-INF/DefaultTemplateOneColumn.xhtml">

        <f:metadata>
            <ui:remove>
                <!-- KANN GET-PARAMETER ENTGEGENNEHMEN UND WEITERREICHEN    -->
                <!-- <f:viewParam name="foo" value="#{bean.foo}" />-->
                <!-- FÜHRT METHODEN BEI PAGELOAD AUS-->
            </ui:remove>
            <f:viewAction action="#{backingBeanVisit.proxyOnLoad()}" />
        </f:metadata>

        <ui:param name="active" value="Visit" />
        <ui:param name="title" value="Restaurantbesuche Übersicht" />

        <ui:define name="titleHeader">
            <h2>#{title}</h2>
        </ui:define>

        <ui:define name="mainContent">

            <p:growl id="visitListGrowl" showDetail="false"  />

            <h:dataTable value="#{backingBeanVisit.getAllVisitsProxy()}" var="visitListEntry" class="table">
                <h:column>
                    <f:facet name="header">Datum</f:facet>
                    #{visitListEntry.getVisitingDateTime()}
                </h:column>

                <h:column>
                    <f:facet name="header">Geplant in</f:facet>
                    #{visitListEntry.getAddressVisit().getCity()}
                </h:column>

                <h:column>
                    <f:facet name="header">Status</f:facet>
                    #{visitListEntry.stateVisit.name()}
                </h:column>

                <h:column>
                    <f:facet name="header">Restaurant</f:facet>
                    #{visitListEntry.restaurantChosen.getName()}
                </h:column>

                <h:column>
                    <f:facet name="header">Teilnehmer</f:facet>
                    #{visitListEntry.getParticipantsAsString(null)}
                </h:column>

                <h:column>
                    <f:facet name="header">Bewertungen</f:facet>
                    #{visitListEntry.getRatings().size()}
                </h:column>

                <h:column>
        <ui:remove>
<!--            <h:form rendered="#{backingBeanVisit.isUserParticipantOf(visitListEntry) || (backingBeanVisit.isUnfinished(visitListEntry))}">-->
<!--            NACH ABLAUF DER MEETING TIME DARF DER VISIT NICHT MEHR BEARBEITBAR SEIN, RATING DANN NUR ÜBER DEN GRÜNEN STERN AUS LIST HERAUS-->
<!--            AUCH NICHT BEARBEITBAR ÜBER ANWÄHLEN DER URL VisitCreate VisitSuggestions-->
        </ui:remove>
                    <h:form>
                        <h:commandLink action="#{backingBeanVisit.edit(visitListEntry)}" actionListener="#{backingBeanVisit.getAllVisits()}" class="btn btn-warning"  style="margin-right: .5rem; float:left;"><i class="far fa-edit" aria-hidden="true"></i></h:commandLink>
                        <h:commandLink action="#{backingBeanVisit.delete(visitListEntry)}" class="btn btn-danger"  style="margin-right: .5rem; float:left;"><i class="fas fa-trash-alt" aria-hidden="true"></i></h:commandLink>
                        <h:commandLink action="#{backingBeanVisit.rate(visitListEntry)}" class="btn btn-success"  style="margin-right: .5rem; float:left;"><i class="fas fa-star-half-alt" aria-hidden="true"></i></h:commandLink>
                    </h:form>
                </h:column>
            </h:dataTable>


            <br/>
            <h:form id="buttons" >
                <h:inputHidden id="hidden" value="#{backingBeanVisit.zoneString}" />
                <h:commandLink action="#{backingBeanUser.createNew()}" class="btn btn-primary" style="margin-right: .5rem; float:left;">User anlegen</h:commandLink>
                <h:commandLink action="#{backingBeanRestaurant.createNew()}" class="btn btn-primary" style="margin-right: .5rem;">Restaurant anlegen</h:commandLink>
                <h:commandLink  action="#{backingBeanVisit.createNew()}" class="btn btn-primary" style="margin-right: .5rem; ">Restaurantbesuch anlegen</h:commandLink >
            </h:form>



            <script type="text/javascript">
                jQuery(document).ready(function() { // läuft still nach dem Laden der Seite
                    const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    document.getElementById("buttons:hidden").setAttribute("value", timeZone.toString());
                })
            </script>

        </ui:define>

        <ui:define name="subContent">
            <h1>sub</h1>
        </ui:define>

        <ui:define name="footer">
        </ui:define>

    </ui:composition>
</html>