<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:o="http://omnifaces.org/ui" xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
>

<ui:composition template="WEB-INF/DefaultTemplateTwoColumns.xhtml">
    <ui:remove>
        <!--        <f:metadata>-->
        <!--            <f:viewAction action="#{suggestionsBean.proxyOnLoad()}" />-->
        <!--        </f:metadata>-->
    </ui:remove>

    <ui:param name="active" value="Visit" />
    <ui:param name="title" value="Restaurant auswählen" />

    <ui:define name="titleHeader">
        <h2>#{title}</h2>
    </ui:define>

    <!-- Map View -->
    <ui:define name="subContent">

        <script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=true&amp;key=AIzaSyDtJoxBmEHGk8KsyyiBcynKz5NrdxnELvE"></script>

        <div class="card" style="width:100%; height:900px; align-content: flex-start">
            <p:gmap id="gmap" center="#{suggestionsBean.centerString}" zoom="#{suggestionsBean.googleZoomLevel}" type="ROADMAP"
                    style="width:100%;height:100%" fitBounds="true"
                    model="#{suggestionsBean.gmapModel}"  draggable="true" disableDefaultUI="false" streetView="false" mapTypeControl="false">

                <p:ajax event="overlaySelect" listener="#{suggestionsBean.onMarkerSelect}"/>
                <p:ajax event="markerDrag" listener="#{suggestionsBean.proxyMarkerDrag}" update="gmap visitCreate:dt-suggestions" delay="500"/>

                <p:gmapInfoWindow id="infoWindow">
                    <p:outputPanel style="text-align: center; display: block; margin: auto">
                        <!-- <p:graphicImage name="/demo/images/antalya/#{infoWindowView.marker.data}" height="150"/>-->
                        <!-- <br/>-->
                        <h:outputText value="#{suggestionsBean.marker.title}"/>
                    </p:outputPanel>
                </p:gmapInfoWindow>
            </p:gmap>
        </div>

    </ui:define>

    <!--Visit Daten eingrenzen-->
    <ui:define name="mainContent">

        <h:form id="visitCreate">
            <h:inputHidden value="#{backingBeanVisit.current.prim}" />
            <h:inputHidden id="sizeParticipants_Actual" value="#{backingBeanVisit.sizeParticipantsForValidator}" validator="serverValidatorParticipants"/>
            <h:inputHidden id="sizeParticipants_Initial" value="#{backingBeanVisit.sizeParticipantsForValidator}" />

            <!-- Ort -->
            <ui:remove>
                <!--                <div class="row">-->
                <!--                    <div class="col-4">-->
                <!--                        <label for="place">PLZ und Ort: <h:message for="place" class="text-danger" /></label>-->
                <!--                    </div>-->

                <!--                    <div class="col-3">-->
                <!--                        <h:inputText id="zip"  value="#{backingBeanVisit.current.addressVisit.zipCode}" class="form-control" required="false" disabled="true"/>-->
                <!--                    </div>-->

                <!--                    <div class="col-5">-->
                <!--                        <h:inputText id="place" value="#{backingBeanVisit.current.addressVisit.city}" class="form-control" required="false" disabled="true">-->
                <!--                        </h:inputText>-->
                <!--                    </div>-->
                <!--                </div>-->
                <!--                <br/>-->
            </ui:remove>

<!-- Umkreis Text -->
            <div class="row">
                <div class="col-4">
                    <label for="radius">Suchradius:</label>
                </div>

                <div class="col-3">
                    <h:inputText id="radius" value="#{suggestionsBean.distanceSearchRadius}" valueChangeListener="#{suggestionsBean.proxyRadiusChangedText}"
                                 class="form-control" required="false" validatorMessage="Werte zwischen 0 und 20.000 sind erlaubt.">
                        <p:ajax event="keyup" immediate="true" async="true" delay="100" update="gmap @this slider visitCreate:dt-suggestions" />
                        <f:validateLongRange minimum="0" maximum="20000" />
                    </h:inputText>
                    <p:messages id="messageForRadius" for="radius" display="icon" style="padding-left: 1px" />
                </div>

                <!-- Umkreis Slider -->
                <div class="col-5" style="padding-top: 18px;">
                    <p:slider id="slider" for="radius" minValue="1" maxValue="50" step="1" range="max" style="margin: 0px auto;" >
                        <p:ajax event="slideEnd" immediate="true" async="true" update="gmap radius visitCreate:dt-suggestions"
                                listener="#{suggestionsBean.proxyRadiusChangedSlider}" />
                    </p:slider>
                </div>

            </div>
            <br/>

<!-- Kulinarik -->
            <div class="row" style="height: 65px; align-content: flex-start">
                <div class="col-4">
                    <label>Kulinarik Wunsch:</label>
                </div>

                <div class="col-8">
                    <p:selectCheckboxMenu id="multiple" value="#{backingBeanVisit.culinariesArray}" style="width:100%; !important;"
                                          converter="omnifaces.SelectItemsConverter" label="Label"
                                          multiple="true"  filter="true" filterMatchMode="startsWith"
                                          valueChangeListener="#{suggestionsBean.proxyCulinariesChanged}">

                        <p:ajax event="change" immediate="true" async="true" update="gmap visitCreate:dt-suggestions"/>
                        <p:ajax event="toggleSelect" immediate="true" async="true" update="gmap visitCreate:dt-suggestions" />


                        <f:selectItems value="#{backingBeanVisit.allCulinariesProxy}" style="width:100%; !important;"/>
                    </p:selectCheckboxMenu>

                </div>
            </div>
            <br/>

            <!-- DataTable Visit Suggestions -->
            <!-- <p:growl id="visitCreateGrowl" showDetail="false"  />-->
            <p:dataTable id="dt-suggestions" widgetVar="dt-suggestions-var" var="restaurant"  reflow="false"
                         styleClass="products-table" stripedRows="true" size="medium"
                         style="border: 0px solid transparent; outline: 1px solid lightgrey; padding-right: 0px"
                         rows="10" paginator="false" paginatorPosition="bottom"
                         value="#{suggestionsBean.getRestaurantsFiltered()}" rowKey="#{restaurant.prim}"
                         selection="#{suggestionsBean.currentVisit.restaurantChosen}" >

                <!--                        <p:ajax event="rowSelect" update="@this" process="@this" immediate="false" async="true"/>-->

                <!--                        <p:ajax event="rowSelectRadio" update="@this"  process="@this" immediate="false" async="true"/>-->

                <f:facet name="header">
                    <div class="products-table-header">
                        <div class="row">
                            <div class="col-6" >
                                <span style="font-weight: bold;">Wo soll gegessen werden?</span>
                            </div>

                            <div class="col-6">
                                <p:commandButton id="toggler" type="button" value="Spalten" icon="pi pi-align-justify" style="margin-right: .5rem; float:right;"/>
                                <p:columnToggler datasource="dt-suggestions" trigger="toggler"  />
                                <ui:remove>
                                    <!--                                        <p:commandButton id="more" type="button" value="Mehr Vorschläge!" icon="pi pi-search-plus" style="margin-right: .5rem; float:right;"/>-->
                                </ui:remove>
                            </div>
                        </div>
                    </div>
                </f:facet>

                <p:column headerText="" selectionMode="single" colspan="2" toggleable="false"></p:column>

                <p:column headerText="Name" colspan="5" >
                    <h:outputText value="#{restaurant.name}"/>
                </p:column>

                <p:column headerText="Ort" colspan="5" >
                    <h:outputText value="#{restaurant.addressRestaurant.city}"/>
                </p:column>

                <p:column headerText="Entfernung" colspan="4" style="align-content: center" >
                    <h:outputText value="#{restaurant.distanceMeetingPoint}" style="text-align: center; align-self: center">                                                                     ">
                        <f:convertNumber type="currency" minFractionDigits="1" maxFractionDigits="1" currencySymbol="km"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="Öffnet" colspan="5" visible="false">
                    <h:outputText value="#{restaurant.openFrom}"/>
                </p:column>

                <p:column headerText="Schließt" colspan="5" visible="false">
                    <h:outputText value="#{restaurant.openTill}"/>
                </p:column>

                <p:column headerText="Essen" colspan="5" >
                    <h:outputText value="#{restaurant.culinary}"/>
                </p:column>

                <p:column headerText="Besuche" colspan="5" visible="false">
                    <h:outputText value="#{restaurant.visits.size()}"/>
                </p:column>

                <p:column headerText="Bewertung" colspan="8" >
                    <p:rating value="#{restaurant.averageRating}" stars="#{ratingBean.numberOfStars}" readonly="true" />
                </p:column>

            </p:dataTable>

            <!-- Buttons -->
            <br/>
            <h:commandButton action="VisitList?faces-redirect=true" actionListener="#{suggestionsBean.saveVisitBackingBean}" value="Zurück zur Übersicht" class="btn btn-primary" style="margin-left: .5rem; float:left;"/>
            <h:commandButton action="VisitCreate?faces-redirect=true" actionListener="#{suggestionsBean.saveVisitBackingBean}" value="Zurück zur Planung" class="btn btn-primary" style="margin-left: .5rem; "/>
        </h:form>

    </ui:define>

    <ui:define name="footer">
    </ui:define>

</ui:composition>


</html>